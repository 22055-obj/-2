<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã”ã¿åˆ†åˆ¥AIï¼šã‚³ãƒ³ãƒ‘ã‚¯ãƒˆç‰ˆ</title>
    <style>
        body { font-family: sans-serif; text-align: center; background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h1 { font-size: 1.2rem; margin: 0 0 10px 0; }

        /* ç”»åƒã¨çµæœã‚’æ¨ªã«ä¸¦ã¹ã‚‹ãŸã‚ã®è¨­å®š */
        .main-layout {
            display: flex;
            flex-wrap: wrap; /* ç”»é¢ãŒç‹­ã„ã¨ãã¯æŠ˜ã‚Šè¿”ã™ */
            gap: 15px;
            align-items: flex-start;
            justify-content: center;
        }

        /* è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼šé«˜ã•ã‚’150pxã«å›ºå®š */
        #display-area { 
            flex: 0 0 auto;
            width: 200px; /* æ¨ªå¹…ã‚’åˆ¶é™ */
            height: 150px; 
            background: #eee; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden; 
        }

        canvas, img { 
            height: 150px !important; 
            width: auto !important; 
            object-fit: contain; 
        }

        /* çµæœã‚«ãƒ¼ãƒ‰ï¼šç”»åƒã¨ä¸¦ã¶ã‚ˆã†ã«èª¿æ•´ */
        #result-card { 
            flex: 1; /* ä½™ã£ãŸã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹ */
            min-width: 200px;
            padding: 10px; 
            border-radius: 10px; 
            border-left: 8px solid #ccc; 
            background: #fafafa; 
            text-align: left;
            box-sizing: border-box;
        }

        .label-text { font-size: 1.2rem; font-weight: bold; margin-bottom: 5px; }
        #instruction-text { font-size: 0.9rem; line-height: 1.4; margin-bottom: 5px; }
        .prob-text { font-size: 0.8rem; color: #888; }

        .controls { 
            margin-top: 15px; 
            display: flex; 
            flex-direction: row; /* ãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã« */
            gap: 10px; 
            justify-content: center;
        }
        
        button, label { 
            flex: 1;
            padding: 10px 5px; 
            font-size: 0.85rem; 
            cursor: pointer; 
            background: #007bff; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            display: inline-block;
        }
        #file-input { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h1>ã”ã¿åˆ†åˆ¥AIã‚«ãƒ¡ãƒ©</h1>
    
    <div class="main-layout">
        <div id="display-area">
            <p id="placeholder" style="font-size: 0.8rem;">ç”»åƒå¾…ã¡</p>
        </div>

        <div id="result-card">
            <div id="label-name" class="label-text">åˆ¤å®šçµæœ</div>
            <div id="instruction-text">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã™ã‚‹ã‹å†™çœŸã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</div>
            <div id="probability" class="prob-text"></div>
        </div>
    </div>

    <div class="controls">
        <button type="button" onclick="initCamera()">ğŸ“¸ ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
        <label for="file-input">ğŸ“ ç”»åƒé¸æŠ</label>
        <input type="file" id="file-input" accept="image/*" onchange="handleImage(event)">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.20.0/dist/tf.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>

<script type="text/javascript">
    const URL = "https://teachablemachine.withgoogle.com/models/2w7Qu1Ejv/"; 

    let model, webcam, maxPredictions;
    const labelName = document.getElementById("label-name");
    const instrText = document.getElementById("instruction-text");
    const probDisplay = document.getElementById("probability");
    const displayArea = document.getElementById("display-area");

    async function loadModel() {
        if (!model) {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();
        }
    }

    async function initCamera() {
        await loadModel();
        displayArea.innerHTML = ""; 
        webcam = new tmImage.Webcam(400, 400, true); 
        await webcam.setup();
        await webcam.play();
        displayArea.appendChild(webcam.canvas);
        window.requestAnimationFrame(cameraLoop);
    }

    async function cameraLoop() {
        webcam.update();
        await predict(webcam.canvas);
        window.requestAnimationFrame(cameraLoop);
    }

    async function handleImage(event) {
        await loadModel();
        const file = event.target.files[0];
        if (!file) return;

        const img = document.createElement("img");
        img.src = window.URL.createObjectURL(file);
        img.onload = async () => {
            displayArea.innerHTML = "";
            displayArea.appendChild(img);
            await predict(img); 
        };
    }

    async function predict(inputElement) {
        const prediction = await model.predict(inputElement);
        
        let highestProb = 0;
        let bestMatch = "";
        for (let i = 0; i < maxPredictions; i++) {
            if (prediction[i].probability > highestProb) {
                highestProb = prediction[i].probability;
                bestMatch = prediction[i].className;
            }
        }

        if (highestProb > 0.5) {
            labelName.innerText = bestMatch;
            probDisplay.innerText = "ä¿¡é ¼åº¦: " + (highestProb * 100).toFixed(1) + "%";
            updateInstruction(bestMatch);
        }
    }

    function updateInstruction(match) {
        const instructions = {
            "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«": "ãƒ©ãƒ™ãƒ«ã¨ã‚­ãƒ£ãƒƒãƒ—ã‚’å¤–ã—ã¦æ´—æµ„ã—ã¦ãã ã•ã„ã€‚",
            "ç¼¶": "ä¸­ã‚’æ´—ã£ã¦ä¹¾ç‡¥ã•ã›ã¦ãã ã•ã„ã€‚",
            "ãƒ“ãƒ³": "ã‚­ãƒ£ãƒƒãƒ—ã‚’å–ã‚Šã€ä¸­ã‚’æ´—ã£ã¦è‰²åˆ¥ã«åˆ†åˆ¥ã€‚",
            "ãã®ä»–": "åœ°åŸŸã®ãƒ«ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"
        };
        const collectionDays = {
            "ãƒ“ãƒ³": "ç¬¬3æ°´æ›œ",
            "ç¼¶": "ç¬¬2ãƒ»4æ°´æ›œ",
            "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«": "ç¬¬1æ°´æ›œ"
        };
    
        instrText.innerText = instructions[match] || "---";
        if (collectionDays[match]) {
            probDisplay.innerText += ` ï¼ åé›†æ—¥ï¼š${collectionDays[match]}`;
        }
    
        const colors = {
            "ãƒšãƒƒãƒˆãƒœãƒˆãƒ«": "#007bff", "ç¼¶": "#28a745", "ãƒ“ãƒ³": "#ffc107", "ãã®ä»–": "#6c757d"
        };
        document.getElementById("result-card").style.borderLeftColor = colors[match] || "#ccc";
    }
</script>
</body>
</html>ã€€

